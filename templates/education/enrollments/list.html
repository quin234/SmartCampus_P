{% extends 'education/base.html' %}

{% block title %}Enrollments - SmartCampus{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title"><i class="fas fa-clipboard-list"></i> Student Enrollments</h2>
        {% if user.is_college_admin %}
        <a href="{% url 'enrollment_create' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Enroll Student
        </a>
        {% endif %}
    </div>
    
    <div class="filters">
        <div class="filter-group">
            <label class="form-label">Unit</label>
            <select class="form-select" onchange="window.location.href='?unit=' + this.value">
                <option value="">All Units</option>
                {% for unit in units %}
                    <option value="{{ unit.pk }}" {% if request.GET.unit == unit.pk|stringformat:"s" %}selected{% endif %}>{{ unit.code }} - {{ unit.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="filter-group">
            <label class="form-label">Academic Year</label>
            <select class="form-select" onchange="window.location.href='?year=' + this.value">
                <option value="">All Years</option>
                <option value="2023/2024" {% if request.GET.year == '2023/2024' %}selected{% endif %}>2023/2024</option>
                <option value="2024/2025" {% if request.GET.year == '2024/2025' %}selected{% endif %}>2024/2025</option>
                <option value="2025/2026" {% if request.GET.year == '2025/2026' %}selected{% endif %}>2025/2026</option>
                <option value="2026/2027" {% if request.GET.year == '2026/2027' %}selected{% endif %}>2026/2027</option>
            </select>
        </div>
    </div>
    
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Admission Number</th>
                    <th>Unit Code</th>
                    <th>Unit Name</th>
                    <th>Academic Year</th>
                    <th>Semester</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for enrollment in enrollments %}
                <tr>
                    <td>{{ enrollment.student.full_name }}</td>
                    <td>{{ enrollment.student.admission_number }}</td>
                    <td>{{ enrollment.unit.code }}</td>
                    <td>{{ enrollment.unit.name }}</td>
                    <td>{{ enrollment.academic_year }}</td>
                    <td>Semester {{ enrollment.semester }}</td>
                    <td>
                        <a href="{% url 'result_edit' enrollment.pk %}" class="btn btn-sm btn-primary">Enter Results</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: 2rem;">No enrollments found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    {% if enrollments.has_other_pages %}
    <div class="pagination">
        {% if enrollments.has_previous %}
            <a href="?page={{ enrollments.previous_page_number }}">&laquo; Previous</a>
        {% endif %}
        <span class="current">Page {{ enrollments.number }} of {{ enrollments.paginator.num_pages }}</span>
        {% if enrollments.has_next %}
            <a href="?page={{ enrollments.next_page_number }}">Next &raquo;</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

