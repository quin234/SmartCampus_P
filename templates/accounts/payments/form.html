{% extends 'accounts/base.html' %}

{% block title %}{{ title }} - Accounts{% endblock %}
{% block icon %}money-bill-wave{% endblock %}
{% block page_title %}{{ title }}{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<style>
    .select2-container {
        width: 100% !important;
    }
    .select2-container--default .select2-selection--single {
        height: 38px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
    }
    .select2-container--default .select2-selection--single .select2-selection__rendered {
        line-height: 38px;
        padding-left: 12px;
    }
    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 36px;
    }
</style>
{% endblock %}

{% block content %}
<div class="content-card">
    <div class="card-body">
        <form method="post" class="form-section">
            {% csrf_token %}
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-user-graduate"></i>
                        {{ form.student.label }}
                    </label>
                    {{ form.student }}
                    {% if form.student.errors %}
                        <div class="form-error">{{ form.student.errors }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-money-bill-wave"></i>
                        {{ form.amount_paid.label }}
                    </label>
                    {{ form.amount_paid }}
                    {% if form.amount_paid.errors %}
                        <div class="form-error">{{ form.amount_paid.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-credit-card"></i>
                        {{ form.payment_method.label }}
                    </label>
                    {{ form.payment_method }}
                    {% if form.payment_method.errors %}
                        <div class="form-error">{{ form.payment_method.errors }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-barcode"></i>
                        {{ form.transaction_code.label }}
                    </label>
                    {{ form.transaction_code }}
                    {% if form.transaction_code.errors %}
                        <div class="form-error">{{ form.transaction_code.errors }}</div>
                    {% endif %}
                    <small class="form-text">MPesa code, cheque number, bank reference, etc.</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-calendar-day"></i>
                        {{ form.date_paid.label }}
                    </label>
                    {{ form.date_paid }}
                    {% if form.date_paid.errors %}
                        <div class="form-error">{{ form.date_paid.errors }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-group full-width">
                <label class="form-label">
                    <i class="fas fa-sticky-note"></i>
                    {{ form.notes.label }}
                </label>
                {{ form.notes }}
                {% if form.notes.errors %}
                    <div class="form-error">{{ form.notes.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Record Payment
                </button>
                <a href="{% url 'accounts:payment_list' %}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    jQuery(document).ready(function($) {
        // Initialize Select2 on student dropdown with search functionality
        $('#id_student_select').select2({
            placeholder: 'Search by admission number or name...',
            allowClear: true,
            width: '100%',
            theme: 'default',
            minimumInputLength: 0  // Allow searching from the start
        });
    });
</script>
{% endblock %}

